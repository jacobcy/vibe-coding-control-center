## Context

当前 Vibe Workflow Engine 的四闸机制（Scope/Plan/Execution/Review Gate）已成熟，支持 Superpower 和 OpenSpec 两种工作流框架。但用户需要显式调用特定框架，缺乏智能调度能力。

**约束：**
- 语言：Zsh
- 入口：`bin/vibe`
- 模块：`lib/*.sh`
- Agent 工作区：`.agent/`
- LOC 限制：lib + bin <= 1200 行

## Goals / Non-Goals

**Goals:**
1. 实现智能调度器 - 根据需求特征自动选择框架
2. 实现历史 Pattern 匹配 - 基于历史记录做智能推荐
3. 实现无感自动选择 - 高置信度场景用户无感知
4. 记录框架选择 - 存储到 task.md 用于未来匹配

**Non-Goals:**
- 不实现 NLP 意图识别（用简单的特征分析）
- 不强制用户选择框架（尽量自动判断）
- 不合并 Superpower 和 OpenSpec 为单一系统

## Decisions

### D1: 调度器作为 Gate 0（前置层）

**选择:** 在 vibe-orchestrator SKILL.md 中添加 Gate 0: Intent Gate

**理由:**
- 不破坏现有的四闸机制
- 调度逻辑与 Orchestrator 紧邻，便于共享上下文
- 符合 CLAUDE.md 中的模块职责划分

### D2: 基于 Pattern 的智能匹配

**选择:** 使用历史 Pattern 匹配而非 NLP 分析

**理由:**
- 简单可靠，易于实现
- task.md 已有足够的历史信息
- 不引入额外的复杂度

**匹配维度：**
- 复杂度：简单/中等/复杂
- 类型：新功能/Bug修复/重构/文档
- 范围：单文件/单模块/跨模块
- 不确定性：明确/需要探索/频繁变更

### D3: 置信度驱动的决策

**选择:** 根据置信度决定交互方式

| 置信度 | 行为 |
|--------|------|
| 高 | 无感自动选择，直接进入 |
| 中 | 推荐确认，一句话询问 |
| 低 | 主动询问，提供选项 |
| 极低 | 澄清需求，获取更多信息 |

**理由:**
- 最大化无感体验
- 只在必要时打断用户
- 渐进式交互

## Risks / Trade-offs

| Risk | 描述 | Mitigation |
|------|------|------------|
| R1 | 错误判断用户意图 | 提供简单的"换个方式"选项 |
| R2 | task.md 格式变更影响解析 | 使用稳定的正则表达式匹配 |
| R3 | 历史记录不足导致低置信度 | 提供合理的默认推荐 |
