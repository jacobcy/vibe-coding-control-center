# Vibe Coding Control Center - 项目理解指南

## 🎯 项目定位

这是一个 **AI 开发工具管理中心**，用于统一管理和配置多个 AI 编程助手工具。

### 核心功能
1. **统一安装和配置** Claude / OpenCode / Codex 等 AI 工具
2. **菜单驱动界面** 提供友好的交互式控制中心
3. **项目初始化** 快速创建带有最佳实践的新项目
4. **安全管理** API 密钥和环境变量
5. **MCP 集成** Model Context Protocol 支持（GitHub、搜索等）

## 📁 项目结构

```
vibe-coding-control-center/
│
├── bin/                        # git 风格子命令入口
│   ├── vibe                   # 入口分发器 (vibe <subcmd>)
│   ├── vibe-init              # 子命令示例
│   └── vibe-chat              # 子命令示例
│
├── .agent/                     # Agent 配置与工作流
│   ├── context/              # AI 上下文 (memory.md, task.md, agent.md：初始化后生成)
│   ├── workflows/            # 自动化工作流
│   ├── templates/            # 提示词模板
│   └── rules/                # 行为规则
│
├── scripts/                    # 核心脚本
│   ├── vibecoding.sh          # 主控制中心（后端）
│   ├── backup-project.sh      # 项目备份工具
│   └── ...
│
├── install/                    # 安装脚本
│   ├── install-claude.sh      # Claude Code 安装（官方）
│   ├── install-opencode.sh    # OpenCode 安装（中国可用）
│   └── init-project.sh        # 项目初始化
│
├── config/                     # 配置文件
│   ├── keys.env              # API 密钥（不提交到 git）
│   ├── keys.template.env     # 密钥模板（提交到 git）
│   └── aliases.sh            # 命令别名
│
├── lib/                        # 工具库
│   ├── utils.sh              # 共享工具函数
│   ├── config.sh             # 配置管理
│   ├── agents.sh             # 工具选择/单行调用
│   ├── init_project.sh       # 初始化逻辑（AI/本地）
│   ├── error_handling.sh     # 错误处理（预留扩展）
│   └── i18n.sh               # 国际化
│
├── docs/                       # 文档
│   ├── agents-guide.md       # Agent 使用指南
│   ├── usage_advice.md       # 使用建议
│   ├── prd-refactor-tools.md # 重构 PRD（文档阶段）
│   ├── tech-spec-refactor-tools.md # 重构技术规格
│   └── test-plan-refactor-tools.md # 重构测试文档
│
└── README.md                   # 项目说明
```

## 🔑 核心概念

### 1. 多工具支持

项目支持三个 AI 编程助手（优先级：Claude → OpenCode → Codex）：

#### Claude Code（官方，需要国际网络）
- **API 端点**: `https://api.anthropic.com`
- **模型**: `claude-sonnet-4-5`
- **认证**: Auth Token（`sk-ant-` 或 `sk-sp-` 开头）
- **适用**: 有国际网络访问的用户

#### OpenCode（中国可用）
- **模型**: Qwen / DeepSeek / Moonshot 等
- **认证**: 对应模型 API Key（可选）
- **适用**: 中国大陆用户或需要多模型支持的用户

#### Codex（第三优先级）
- **定位**: 在 Claude/OpenCode 不适用时补位
- **启用**: 通过 alias 与环境变量配置启用

### 2. 环境变量配置

**重要**：统一使用 `ANTHROPIC_AUTH_TOKEN`，不要混用 `ANTHROPIC_API_KEY`，避免环境冲突。

所有配置通过环境变量管理，可存储在 `config/keys.env`（可选）：

```bash
# Claude Code（官方）
ANTHROPIC_AUTH_TOKEN=<your-auth-token-here>                 # 统一使用 AUTH_TOKEN
ANTHROPIC_BASE_URL=https://api.anthropic.com
ANTHROPIC_MODEL=claude-sonnet-4-5

# Claude Code（中国默认 - 中转站）
ANTHROPIC_AUTH_TOKEN=<your-auth-token-here>
ANTHROPIC_BASE_URL=https://api.myprovider.com  # 替换成你的中转站
ANTHROPIC_MODEL=claude-sonnet-4-5

# OpenCode（原生支持多模型，无需配置）
# OpenCode 本身就支持 Qwen、DeepSeek、Moonshot 等模型
# 只需要配置对应的 API Key（可选）
DEEPSEEK_API_KEY=<your-deepseek-key-here>
MOONSHOT_API_KEY=<your-moonshot-key-here>

# 其他 API 密钥
GITHUB_PERSONAL_ACCESS_TOKEN=<your-github-token-here>
BRAVE_API_KEY=<your-brave-api-key-here>
```

### Worktree 隔离与身份
- 每个 agent 使用独立 worktree
- 在 worktree 内配置独立 Git 身份（如 user.name / user.email）
- 通过 alias 启动对应 agent 与配置

### TDD 工作模式
依次完成：PRD → 技术规格 → 测试文档 → 测试代码 → 正式代码 → Review → PR

### 命令别名

安装后可用的快捷命令：

```bash
# Claude Code
c              # 启动 Claude 交互模式
claude -p "问题"   # 单行 prompt

# OpenCode
o              # 启动 OpenCode 交互模式
opencode run "问题" -m opencode/kimi-k2.5-free

# 控制中心
vibe           # 启动 Vibe Coding Control Center
vibe init --ai # AI 初始化（默认）
vibe init --local # 本地模板
vibe chat / vc # 进入默认工具对话（交互模式）
vibe chat "问题" # 快速问答（非交互式）
```

## 🌏 中国模式（当前目标态）

### ❌ 不是什么

**不是**通过"模型映射"来实现的！之前的代码创建了一堆 `model_config.json` 配置文件，但这些文件根本不会被使用。

### ✅ 是什么

以 Claude Code 为例，通过环境变量切换端点，实现无需本机代理的访问：

```bash
# 官方模式（需要国际网络）
ANTHROPIC_AUTH_TOKEN=<your-auth-token-here>
ANTHROPIC_BASE_URL=https://api.anthropic.com
ANTHROPIC_MODEL=claude-sonnet-4-5

# 中国模式（中转站）
ANTHROPIC_AUTH_TOKEN=<your-auth-token-here>
ANTHROPIC_BASE_URL=https://api.myprovider.com  # 替换成你的中转站
ANTHROPIC_MODEL=claude-sonnet-4-5
```

**关键点**：
- 同一个 Claude Code CLI 工具
- 通过环境变量切换端点
- 中转站负责转发请求

#### OpenCode（原生支持）

OpenCode 是专门为中国环境设计的 AI 编程助手：

```bash
DEEPSEEK_API_KEY=<your-deepseek-key-here>
MOONSHOT_API_KEY=<your-moonshot-key-here>
```

**关键点**：
- 原生支持 Qwen、DeepSeek、Moonshot 等多种模型
- 不需要任何 hack 或 workaround
- 专为中国环境设计
- **这是正道**

## 🚀 使用场景

### 场景 1：国际用户（有国际网络访问）

```bash
# 安装 Claude Code
./install/install-claude.sh

# 配置 Auth Token
# 编辑 config/keys.env:
ANTHROPIC_AUTH_TOKEN=<your-auth-token-here>
ANTHROPIC_BASE_URL=https://api.anthropic.com
ANTHROPIC_MODEL=claude-sonnet-4-5

# 使用
c "帮我写一个 Python 函数"
```

## 进一步阅读
- `docs/agents-guide.md` - Agent 使用指南与并行 worktree 协作流程

### 场景 2：中国用户 - 方案 A（使用 Claude Code + 中转站）

```bash
# 安装 Claude Code
./install/install-claude.sh

# 配置中转站（让 Claude Code 指向 api.myprovider.com  # 替换成你的中转站）
# 编辑 config/keys.env:
ANTHROPIC_AUTH_TOKEN=sk-ant-xxxxx
ANTHROPIC_BASE_URL=https://api.myprovider.com  # 替换成你的中转站
ANTHROPIC_MODEL=claude-sonnet-4-5

# 使用（同样的命令，但实际使用 Qwen 模型）
c "帮我写一个 Python 函数"
```

**注意**：这是无奈之举，因为无法访问 Anthropic 官方 API。

### 场景 3：中国用户 - 方案 B（使用 OpenCode，推荐）

```bash
# 安装 OpenCode
./install/install-opencode.sh

# 配置对应模型的 API Key（可选）
# 编辑 config/keys.env:
DEEPSEEK_API_KEY=sk-xxxxx
MOONSHOT_API_KEY=sk-xxxxx

# 使用
o "帮我写一个 Python 函数"
```

**推荐**：OpenCode 原生支持多种中国模型，是正道。

## 📝 总结

### 项目的本质
- **工具管理器**：统一管理多个 AI 编程助手
- **配置中心**：集中管理 API 密钥和环境变量
- **快捷入口**：提供便捷的命令别名

### "中国模式"的本质

有两种实现方式：

#### 方式 1：Claude Code + 环境变量 hack（无奈之举）
- **原理**：修改 `ANTHROPIC_BASE_URL` 指向中转站
- **实质**：Claude Code 通过中转站转发请求
- **评价**：这是 workaround，因为无法访问 Anthropic 官方 API

#### 方式 2：OpenCode（正道）
- **原理**：使用专门为中国环境设计的工具
- **实质**：原生支持 Qwen、DeepSeek、Moonshot 等多种模型
- **评价**：这是正道，不需要任何 hack

### 关键理解
1. **Claude Code** 是官方工具，在中国通过修改环境变量使用 Qwen（无奈之举）
2. **OpenCode** 是原生支持多模型的中国友好工具（正道）
3. 通过**环境变量**来配置，而不是什么"映射配置文件"
4. 之前那些 `model_config.json` 配置文件完全是垃圾，没有任何代码读取它们

这就是整个项目的真相！简单、直接、有效。
